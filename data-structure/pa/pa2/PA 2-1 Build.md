# PA 2-1 Build

## 数据结构与算法

本题中使用的数据结构为普通多叉树，对于每个节点用指针存储其父亲、第一个儿子、以及左右兄弟，并存储其高度和子树大小，询问小助教堵君懿后，为维护高度，存储其后继（右兄弟和自己）最大高度。算法方面，输入树时先构建树，然后层次遍历所有节点后再倒序从右往左，从下往上初始化所有点的高度、子树大小以及后继最大高度。查询操作、按路径寻找节点的实现较为直观。移动操作时先删除需移动的节点，再更新其祖先并更新其前驱（左兄弟和祖先以及祖先左兄弟）的高度和后继最大高度。

## 复杂度分析

空间复杂度方面，维护一个有$N$ 个节点的树，复杂度$O(N)$ 。时间复杂度方面，构建树、初始化高度、子树大小的复杂度为$ O(N) $。设所有操作的cost之和为$ C$ （根据题目中条件，$ C\le10^6 $），则所有寻路操作的复杂度之和为$ O(C) $。去除寻路操作复杂度后，查询操作可在$ O(1) $内完成，而子树移动操作的复杂度主要在于高度和子树大小更新，理论上可能遍历所有节点，即每次操作复杂度$ O(N) $。然而经过分析我们可以发现，移动某个节点后，其所有前驱及自己（即所有可能更新的点）的数量恰好为寻路过程中的cost，所以说所有更新操作的复杂度之和也是$ O(C) $。因此，总体复杂度为$O(N+C+M)$。

## 完成过程中的问题

本题我一开始就确定了数据结构与算法，之后也没有改动，操作过程中遇到的几个问题都是特殊情况判断以及边界条件，比如删除节点维护高度要从该点前驱开始，而插入节点维护高度要从该点开始，维护高度时第一个节点有可能是根节点等。